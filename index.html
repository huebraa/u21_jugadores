<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Jugadores U21 con Supabase</title>
<style>
  body { font-family: Arial, sans-serif; background: #f5f8fa; margin: 20px; }
  h1 { color: #004a99; text-align: center; margin-bottom: 1em; }
  .controls { text-align: center; margin-bottom: 1em; }
  input, select { padding: 8px 12px; margin: 0 5px; font-size: 1em; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  thead { background: #004a99; color: #fff; }
  thead th { padding: 10px; }
  tbody tr:nth-child(even) { background: #f0f7ff; }
  tbody tr:hover { background: #ffe7cc; }
  td { padding: 10px; vertical-align: top; }
  .flag { width: 24px; height: 16px; margin-right: 6px; }
  .desc { font-size: 0.9em; color: #333; }
</style>
</head>
<body>

<h1>Jugadores U‑21 con Supabase</h1>
<div class="controls">
  País: 
  <select id="filterPais">
    <option value="all">Todos</option>
  </select>
  Buscar: 
  <input type="text" id="searchNombre" placeholder="Escribe un nombre" />
</div>

<table>
  <thead>
    <tr>
      <th>Nombre</th>
      <th>Posición</th>
      <th>País</th>
      <th>Equipo</th>
      <th>Año</th>
      <th>Descripción</th>
    </tr>
  </thead>
  <tbody id="tablaJugadores">
    <tr><td colspan="6">Cargando...</td></tr>
  </tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // Conexión Supabase
  const supabase = supabase.createClient(
    'REPLACE_WITH_YOUR_URL',
    'REPLACE_WITH_YOUR_ANON_KEY'
  );

  // Carga inicial de países + jugadores
  async function cargarPaisesYJugadores() {
    const { data: jugadores, error } = await supabase
      .from('jugadores')
      .select('*')
      .order('nombre');

    if (error) return console.error(error);
    const paises = [...new Set(jugadores.map(j => j.pais))].sort();

    const sel = document.getElementById('filterPais');
    paises.forEach(p => {
      const opt = document.createElement('option');
      opt.value = p;
      opt.textContent = p;
      sel.appendChild(opt);
    });

    window.jugadoresGlobal = jugadores;
    renderizarTabla();
  }

  function getFlag(country) {
    const codes = { 
      "Finlandia":"fi", "Alemania":"de", "Italia":"it", "Países Bajos":"nl",
      "Dinamarca":"dk","Rumanía":"ro","Chequia":"cz","Inglaterra":"gb-eng",
      "España":"es","Ucrania":"ua","Francia":"fr","Georgia":"ge",
      "Portugal":"pt","Eslovaquia":"sk","Polonia":"pl","Angola":"ao"
    };
    const code = codes[country];
    return code ? `<img src="https://flagcdn.com/w20/${code}.png" class="flag"> ` : '';
  }

  function renderizarTabla() {
    const filtroPais = document.getElementById('filterPais').value;
    const busqueda = document.getElementById('searchNombre').value.toLowerCase();
    const tbl = document.getElementById('tablaJugadores');

    tbl.innerHTML = '';
    window.jugadoresGlobal
      .filter(j => (filtroPais === 'all' || j.pais === filtroPais)
                 && j.nombre.toLowerCase().includes(busqueda))
      .forEach(j => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${j.nombre}</td>
          <td>${j.posicion}</td>
          <td>${getFlag(j.pais)}${j.pais}</td>
          <td>${j.equipo || ''}</td>
          <td>${j.anio || ''}</td>
          <td class="desc">${j.descripcion || ''}</td>
        `;
        tbl.appendChild(tr);
      });

    if (!tbl.children.length) {
      tbl.innerHTML = '<tr><td colspan="6">No se encontraron jugadores</td></tr>';
    }
  }

  document.getElementById('filterPais').addEventListener('change', renderizarTabla);
  document.getElementById('searchNombre').addEventListener('input', renderizarTabla);

  window.addEventListener('DOMContentLoaded', cargarPaisesYJugadores);
</script>

</body>
</html>
